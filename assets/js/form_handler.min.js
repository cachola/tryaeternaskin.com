!function($){"use strict";$.fn.formHandler=function(_selfOptions){if(!this.length)return!1;$(this).attr("novalidate","novalidate");_selfOptions=$.extend({},{errorModal:!0,autoFillFormElement:!1,countryDropdown:"Select Country",ajaxLoader:{div:"",timeInOut:0},responseLoader:{div:"",timeInOut:0}},_selfOptions);var _self=$(this);if(_self.find("input[name=shippingState]").change((function(e){$("body").data({chromeAutofilled:$(this).val()}),getStates("shippingState","shippingCountry")})),_selfOptions.autoFillFormElement){var _copyToForm=$("form[name="+_selfOptions.autoFillFormElement+"]");_self.find("input[type=text]").on("keyup",(function(){var elem=$(this).attr("name");_copyToForm.find("input[name="+elem+"]").val($(this).val())})),_self.find("textarea").on("keyup",(function(){var elem=$(this).attr("name");_copyToForm.find("textarea[name="+elem+"]").val($(this).val())}))}function performRegularBlurEvent(element){if(element.removeClass(cb.errorClass).removeClass(cb.validClass),element.val().length){element.addClass(cb.errorClass);var value=element.val().trim();if(""!==value){var minLength=1,maxLength=100;void 0!==element.data("min-length")&&(minLength=parseInt(element.data("min-length"))),void 0!==element.data("max-length")&&(maxLength=parseInt(element.data("max-length"))),value.length<minLength||value.length>maxLength||element.removeClass(cb.errorClass).addClass(cb.validClass)}}}function callSepa(type){"show"==type?($(".sepa-block,.sepa-block p").show(),$("[name=sepa_iban],[name=sepa_bic],[name=pin_number]").attr("disabled",!1),$("[name=sepa_iban],[name=sepa_bic],[name=pin_number]").addClass("required")):($(".sepa-block,.sepa-block p").hide(),$("[name=sepa_iban],[name=sepa_bic],[name=pin_number]").attr("disabled",!0),$("[name=sepa_iban],[name=sepa_bic],[name=pin_number]").removeClass("required"))}function callDirectDebit(type){"show"==type?($(".directdebit-block,.directdebit-block p").show(),$("[name=iban],[name=ddbic]").attr("disabled",!1),$("[name=iban],[name=ddbic]").addClass("required")):($(".directdebit-block,.directdebit-block p").hide(),$("[name=iban],[name=ddbic]").attr("disabled",!0),$("[name=iban],[name=ddbic]").removeClass("required"))}function getCountries(countryElementName,stateElementName){var countryElement=_self.find("select[name="+countryElementName+"]"),selectedCountryName=countryElement.data("selected"),countryElementHtml="",no_of_countries=0;$.each(app_config.allowed_country_codes,(function($key,countryCode){app_config.countries.hasOwnProperty(countryCode)&&(no_of_countries++,countryElementHtml+='<option value="'+countryCode+'">'+app_config.countries[countryCode].name+"</option>")})),1!=no_of_countries&&(countryElementHtml='<option value="">'+_selfOptions.countryDropdown+"</option>"+countryElementHtml),countryElement.html(countryElementHtml).trigger("change"),void 0!==selectedCountryName&&selectedCountryName.length&&countryElement.val(selectedCountryName).trigger("change"),getStates(stateElementName,countryElementName)}function getStates(stateElementName,countryElementName){var stateElement=_self.find("input[name="+stateElementName+"]"),selectedStateName=stateElement.data("selected"),countryElement=($("body").data("chromeAutofilled")&&$("body").data("chromeAutofilled"),_self.find("select[name="+countryElementName+"]"));if(0!==countryElement.length&&""!==$(countryElement).val()){var stateElementHtml="",zipElementName=countryElementName.replace("Country","")+"Zip";if(app_config.country_lang_mapping.hasOwnProperty(countryElement.val())?(_self.find("[name="+stateElementName+"]").closest("p, div, tr").find("label").text(app_config.country_lang_mapping[countryElement.val()].state),_self.find("[name="+zipElementName+"]").closest("p, div, tr").find("label").text(app_config.country_lang_mapping[countryElement.val()].zip)):(_self.find("[name="+stateElementName+"]").closest("p, div, tr").find("label").text("State: "),_self.find("[name="+zipElementName+"]").closest("p, div, tr").find("label").text("Zip: ")),$.each(app_config.countries[countryElement.val()].states,(function(stateCode,value){stateCode.length&&"US"==countryElement.val()&&null!=stateCode.match(/Armed Forces/)||(stateElementHtml+='<option value="'+stateCode+'">'+value.name+"</option>")})),stateElementHtml.length){if(!_self.find("select[name="+stateElementName+"]").length){stateElement.attr("class");$('<select name="'+stateElementName+'"/>').insertAfter(stateElement);var attributes=stateElement.get(0).attributes;stateElement.remove(),addAttributesToElement(_self.find("select[name="+stateElementName+"]"),attributes)}var stateLable="State";void 0!==app_config.country_lang_mapping[countryElement.val()]&&void 0!==app_config.country_lang_mapping[countryElement.val()].state&&""!=app_config.country_lang_mapping[countryElement.val()].state&&(stateLable=app_config.country_lang_mapping[countryElement.val()].state.slice(0,-1));var stateDefaultElementHtml="<option value='' selected='selected'>Select "+stateLable+"</option>";_self.find("select[name="+stateElementName+"]").html(stateDefaultElementHtml+stateElementHtml),selectedStateName&&_self.find("select[name="+stateElementName+"]").val(selectedStateName)}else{if(0===_self.find("input[name="+stateElementName+"]").length){(stateElement=_self.find("select[name="+stateElementName+"]")).attr("class");$('<input type="text" name="'+stateElementName+'" readonly />').insertAfter(stateElement);attributes=stateElement.get(0).attributes;stateElement.remove(),addAttributesToElement(_self.find("input[name="+stateElementName+"]"),attributes)}_self.find("input[name="+stateElementName+"]").removeAttr("readonly")}}}function addAttributesToElement(element,attributes){for(var i in attributes)"object"==typeof attributes[i]&&element.attr(attributes[i].name,attributes[i].value)}_self.on("focus","input, select",(function(){"inline"===app_config.show_validation_errors&&$(this).next(".cb-inline-error").remove()})),_self.on("blur","input, select",(function(){$(this).hasClass("required")&&performRegularBlurEvent($(this))})),_self.on("change","input, select",(function(){$(this).hasClass("required")&&performRegularBlurEvent($(this))})),$(document).on("change","select[name$=Country]",(function(){if($("[name=email]").length&&$("[name=creditCardNumber]").length){var cName=$(this).attr("name");"shippingCountry"==cName?(cb.formElementSelectors.country="[name="+cName+"]",cb.formElementSelectors.zip="[name=shippingZip]"):(cb.formElementSelectors.country="[name="+cName+"]",cb.formElementSelectors.zip="[name=billingZip]")}})),_self.find(cb.formElementSelectors.zip).blur((function(){if($(this).hasClass("required")&&($(this).removeClass(cb.errorClass).removeClass(cb.validClass),$(this).val().length)){var country=_self.find(cb.formElementSelectors.country).val();void 0===country&&(country="default"),validator.isValidZip($(this).val(),country)?$(this).addClass(cb.validClass):$(this).addClass(cb.errorClass)}})),_self.find(cb.formElementSelectors.email).blur((function(){$(this).hasClass("required")&&($(this).removeClass(cb.errorClass).removeClass(cb.validClass),$(this).val().length&&(validator.isValidEmail($(this).val())?$(this).addClass(cb.validClass):$(this).removeClass(cb.validClass).addClass(cb.errorClass)))})),_self.find(cb.formElementSelectors.phone).blur((function(){$(this).hasClass("required")&&($(this).removeClass(cb.errorClass).removeClass(cb.validClass),$(this).val().length&&(performRegularBlurEvent($(this)),$(this).hasClass(cb.errorClass)||(validator.isValidPhone($(this).val())?$(this).addClass(cb.validClass):$(this).removeClass(cb.validClass).addClass(cb.errorClass))))})),_self.find(cb.formElementSelectors.cardNumber).blur((function(e){if($(this).hasClass("required")){$(this).removeClass(cb.errorClass).removeClass(cb.validClass);var cardNumberElement=_self.find(cb.formElementSelectors.cardNumber),cardType=_self.find(cb.formElementSelectors.cardType).val(),cardNumber=cardNumberElement.val();if(cardNumber.length){var unmaskedCardNumber=cardNumber.trim().replace(/[\s-]/g,"");if(void 0!==app_config.allowed_tc&&app_config.allowed_tc.length){var isTestCard=!1;if($(app_config.allowed_tc).each((function(k,v){var testCardNumber=v.toString().split("|")[0];if(unmaskedCardNumber===testCardNumber)return isTestCard=!0,!0})),isTestCard)return cardNumberElement.removeClass(cb.errorClass).addClass(cb.validClass),!0}cardNumberElement.removeClass(cb.validClass).addClass(cb.errorClass),validator.isValidCardNumber(unmaskedCardNumber,cardType)&&cardType.length&&cardNumberElement.removeClass(cb.errorClass).addClass(cb.validClass)}}})),_self.find(cb.formElementSelectors.cvv).blur((function(){$(this).hasClass("required")&&($(this).removeClass(cb.errorClass).removeClass(cb.validClass),$(this).val().length&&(performRegularBlurEvent($(this)),$(this).hasClass(cb.errorClass)||(validator.isValidCvv($(this).val())?$(this).addClass(cb.validClass):$(this).removeClass(cb.validClass).addClass(cb.errorClass))))})),_self.find(cb.formElementSelectors.cvv).keyup((function(){$(this).val($(this).val().replace(/[^\d]/g,""))})),"undefined"!==_selfOptions.type&&(getCountries("shippingCountry","shippingState"),_self.find("select[name=shippingCountry]").change((function(){$(this).data("oldValue")!=$(this).val()&&($(this).data({oldValue:$(this).val()}),getStates("shippingState","shippingCountry"))}))),_self.find("input[name=creditCardNumber]").keyup((function(e){$(this).val($(this).val().toString().replace(/[^0-9\s-]/g,""))})),_self.find(cb.formElementSelectors.cardNumber).change((function(e){$(this).trigger("keydown").trigger("keypress").trigger("keyup")})),_self.find("input[name=creditCardNumber]").keyup((function(){var cardNumberElement=_self.find(cb.formElementSelectors.cardNumber),cardTypeElement=_self.find(cb.formElementSelectors.cardType),unmaskedCardNumber=cardNumberElement.val().trim().replace(/[\s-]/g,""),cardType=validator.getCardType(unmaskedCardNumber);if(!1===cardType&&void 0!==app_config.allowed_tc&&app_config.allowed_tc.length){$(app_config.allowed_tc).each((function(k,v){var testCardParts=v.toString().split("|");if(unmaskedCardNumber===testCardParts[0])return cardType=testCardParts[1],!0}))}cardTypeElement.find("option[value="+cardType+"]").length?(cardTypeElement.val(cardType).trigger("change"),cardTypeElement.removeClass(cb.errorClass).addClass(cb.validClass)):0!=_self.find("select[name=creditCardType]").data("deselect")&&(cardTypeElement.val("").trigger("change"),cardTypeElement.addClass(cb.errorClass).removeClass(cb.validClass))})),_self.find("select[name=creditCardType]").change((function(e){var cardType=$(this).val();!function(cardType){"amex"==cardType?$("[name=CVV]").attr("maxlength","4"):$("[name=CVV]").attr("maxlength","3")}(cardType),$.each(["creditCardNumber","expmonth","expyear","CVV"],(function(index,field){"paypal"==cardType||"COD"==cardType||"payu"==cardType?($("[name="+field+"]").removeClass("required").closest("p, div").hide(),callSepa("hide"),callDirectDebit("hide")):"sepa"==cardType?($("[name="+field+"]").removeClass("required").closest("p, div").hide(),callSepa("show"),callDirectDebit("hide")):"DIRECTDEBIT"==cardType?($("[name="+field+"]").removeClass("required").closest("p, div").hide(),callSepa("hide"),callDirectDebit("show")):($("[name="+field+"]").addClass("required").closest("p, div").show(),callSepa("hide"),callDirectDebit("hide"))}));var _length=validator.getCardNumberMaxLength(cardType);_self.find("input[name=creditCardNumber]").attr("maxlength",_length)})),_self.find("input[name=billingSameAsShipping]").change((function(e){"no"==$(this).val()?($(".billing-info").show(),getCountries("billingCountry","billingState"),_self.find("select[name=billingCountry]").change((function(){getStates("billingState","billingCountry")})),$(".billing-info input,.billing-info select").addClass("required")):($(".billing-info input,.billing-info select").removeClass("required"),$(".billing-info input,.billing-info select").removeClass(cb.errorClass),$(".billing-info").hide())})),_self.submit((function(_event){_event.preventDefault();var errors=cb.validateForm(_self,cb.formActions[_selfOptions.type]);if("undefined"!==_selfOptions.type&&"prospect"!=_selfOptions.type&&"fullprospect"!=_selfOptions.type&&"shipping"!=_selfOptions.type&&"upsell"!=_selfOptions.type&&(!function(){var date=new Date,year=date.getFullYear().toString().substr(2,2),month=date.getMonth()+1;if(_self.find(cb.formElementSelectors.cardExpiryMonth).val().length&&_self.find(cb.formElementSelectors.cardExpiryMonth).val()<month&&_self.find(cb.formElementSelectors.cardExpiryYear).val().length&&_self.find(cb.formElementSelectors.cardExpiryYear).val()<=year)return!0;return!1}()?function(){if(app_config.disable_trialoffer_cardexp)return!0;var $expmonth=_self.find("select[name=expmonth]"),$expyear=_self.find("select[name=expyear]"),expiryM=parseInt($expmonth.val()),expiryY=parseInt($expyear.val());if((new Date).setFullYear("20"+expiryY,expiryM-3)-new Date<1)return!1;return!0}()||(errors.cardNumber=app_lang.error_messages.card_expire_soon,_self.find(cb.formElementSelectors.cardNumber).addClass(cb.errorClass)):(errors.cardNumber=app_lang.error_messages.card_expired,_self.find(cb.formElementSelectors.cardNumber).addClass(cb.errorClass))),_self.find(".agree-checkbox").length&&(_self.find(".agree-checkbox").prop("checked")||(void 0!==_self.find(".agree-checkbox").data("error-message")?errors.agreeCheckbox=_self.find(".agree-checkbox").data("error-message"):errors.agreeCheckbox=app_lang.error_messages.not_checked)),0===Object.keys(errors).length){if(_self.find('input[name="user_is_at"]').remove(),_self.append('<input type="hidden" name="user_is_at" value="'+location.href+'" />'),cb.currentFormSubmitEvents=[],Array.isArray(cb.beforeFormSubmitEvents))for(var ii=0,len=cb.beforeFormSubmitEvents.length;ii<len;ii++)"function"==typeof cb.beforeFormSubmitEvents[ii]&&cb.currentFormSubmitEvents.push(cb.beforeFormSubmitEvents[ii]);cb.submitForm(_self,_selfOptions)}else cb.errorHandler(function(errors){var arrangedErrors={};return _self.find("input, select").each((function(){errors.hasOwnProperty($(this).attr("name"))&&(arrangedErrors[$(this).attr("name")]=errors[$(this).attr("name")],delete errors[$(this).attr("name")])})),$.each(errors,(function(key,value){arrangedErrors[key]=value})),arrangedErrors}(errors),_self)}))}}(jQuery);var FwUtils={log:function(){"Y"==app_config.dev_mode&&console.log(arguments)}};